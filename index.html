<!--
Copyright (C) 2014 Google Inc. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<!DOCTYPE html>
<html>
  <head>

    <title>Cast Hello Text</title>
    <link href="https://fonts.googleapis.com/css?family=Aref+Ruqaa" rel="stylesheet">
    <link href="scss/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="scss/welcome.css" />

    <script src="gameBoard.js"></script>


  </head>
  <body>


  <div class = "row">
    <div class = "col-sm-12">
      <h1 class = "center title">AvalonCast</h1>
    </div>
  </div>

<!-- This div is for the Pregrame Lobby UI screen. Contains list of current players in lobby -->
  <div class = "welcome" id = "welcome" style = "">
    <br>
    <br>
    <br>
    <br>


    <div class = "row">
      <div class = "col-sm-1">
      </div>
      <div class = "col-sm-3">
        <img src = "scss/img/goodguy.jpg" class = "center guys">
      </div>
      <div class = "col-sm-4">

        <div class = "center lobby" onclick="testList()">
          <h1 style = "margin:0;">Player List</h1>
          <p id = "playerList" class = "list"></p>
        </div>

      </div>

      <div class = "col-sm-3">
        <img src = "scss/img/badguy.jpg"  class = "center guys">
      </div>


    </div>

  </div>

<!-- This div is for the game board UI screen. -->
  <div class = "gameBoard" id = "gameBoard" style = "display:none">
    <br>
    <!-- This row is for the missions and the players per mission. Players per mission is updated on start of game. -->
    <div class = "row">
      <div class = "col-sm-1">
      </div>
      <div class = "col-sm-2">
        <div class = "turn current">
          <h2 class = "playersPerMission" id = "ppm1">2</h2>
          <p class = "text" id = "1"></p>
        </div>
      </div>
      <div class = "col-sm-2">
        <div class = "turn">
          <h2 class = "playersPerMission" id = "ppm2">3</h2>
          <p class = "text" id = "2"></p>
        </div>
      </div>
      <div class = "col-sm-2">
          <div class = "turn">
            <h2 class = "playersPerMission " id = "ppm3">2</h2>
            <p class = "text" id = "3"></p>
          </div>
      </div>
      <div class = "col-sm-2">
          <div class = "turn">
            <h2 class = "playersPerMission" id = "ppm4">3</h2>
            <p class = "text" id = "4"></p>
          </div>
      </div>
      <div class = "col-sm-2">
          <div class = "turn">
            <h2 class = "playersPerMission" id = "ppm5">3</h2>
            <p class = "text" id = "5"></p>
          </div>
      </div>
    </div>


    <!-- This row displays the current leader and what phase the game is in: select, vote, mission, or assassin. -->
    <div class = "row">
      <div class = "col-sm-12">
          <h2 class="center" id = "currLead"></h2>
      </div>
    </div>

    <!-- This row displays the success/fail cards, the current mission team, and the current voting results. -->
    <div class = "row">
      <div class = "col-sm-1">
      </div>
      <div class = "col-sm-2">
        <div class = "card center" id = "successCard" style = "visibility: hidden">
          <h2 class ="cardHeader sucess center" id = "successHeader">Success x1</h2>
          <img src = "scss/img/sucessGoblet.png" class = "goblet center">
        </div>
      </div>
      <div class = "col-sm-2">
        <div class = "card center" id = "failCard" style = "visibility: hidden">
          <h2 class ="cardHeader fail center" id = "failHeader">Fail x1</h2>
          <img src = "scss/img/failGoblet.png" class = "goblet center">
          </div>
      </div>
      <div class = "col-sm-2 center" id = "MissionTeam" style = "visibility: hidden">
        <div class = "displayBox">
          <h1 class = "center" style = "margin:0;">Mission Team</h1>
          <p class = "text center" id = "currMissionTeam"></p>
        </div>
      </div>
      <div class = "col-sm-2" id = "voteInformationLeft" style = "visibility: hidden">
        <div class = "voteListBox">
          <h1 class = "right" style = "margin:0;">Vote List</h1>
          <p class = "text right" id = "playerVotesLeft"></p>
        </div>
      </div>
      <div class = "col-sm-2" id = "voteInformationRight" style = "visibility: hidden">
        <div class = "voteListBox">
          <h1 class = "" style = "margin:0;"></h1>
          <p class = "text left" id = "playerVotesRight"></p>
        </div>
      </div>

    </div>

    <!-- This row displays the current vote count. Vote count changes after a failed vote. Resets after missions -->
    <div class = "row">
      <div class = "col-sm-5">
      </div>
      <div class = "col-sm-2">
        <div class="voteBox center">
          <h2 class ="voteHeader center" id = "voteCount">Vote Count: 0</h2>
          <h3 class ="voteHeader center" style="margin-bottom: 10px;">Evil wins at 5</h3>
        </div>
      </div>

    </div>


  </div>

  <!-- This div is for the game over UI screen. Contains lists of players and roles as well as who won. -->
  <div class = "gameOver" id = "gameOver" style="display:none">
    <br>
    <br>
    <br>
    <br>

    <div class = "row">
      <div class = "col-sm-12">

        <h1 class = "center"> Game Over</h1>
      </div>
    </div>
    <br>

    <div class = "row">
      <div class = "col-sm-12">
        <h2 class = "who-wins center" id = "who-wins"></h2>
      </div>
    </div>

    <div class = "row">
      <div class = "col-sm-1">
      </div>
      <div class = "col-sm-3">
        <div class = "good-guys-list center goodWins" onclick="testList()">
          <h1 style = "margin:0;">Good Player List</h1>
          <p id = "goodList" class = "list"></p>
        </div>
      </div>


      <div class = "col-sm-4 center">
        <img src = "scss/img/goodguy.jpg" class = "center guys" id = "goodImg"  style = "">
        <img src = "scss/img/badguy.jpg"  class = "center guys" id = "evilImg" style="display:none" >
      </div>


      <div class = "col-sm-3">
        <div class = "bad-guys-list center evilWins" onclick="testList()">
          <h1 style = "margin:0;">Evil Player List</h1>
          <p id = "badList" class="list"></p>
        </div>

      </div>


    </div>

  </div>

    <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/cast/sdk/libs/games/1.0.0/cast_games_receiver.js"></script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="scss/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>

    <script type = "text/javascript">


//This array is used to determine the number of players per mission. Column refers to mission num and row is number of players.
var missionTeamSizes =  [
                        [0,0,0,0,0,0,0,0,0,0,0],
                        [0,2,2,2,2,2,2,2,3,3,3],
                        [0,3,3,3,3,3,3,3,4,4,4],
                        [0,2,2,2,2,2,4,3,4,4,4],
                        [0,3,3,3,3,3,3,4,5,5,5],
                        [0,3,3,3,3,3,4,4,5,5,5]
                        ];

//These are used as enums to see what phase the game is and deny sender messages that are for the wrong phase
var lobbyPhase = 0;
var setupPhase = 1;
var selectPhase = 2;
var votingPhase = 3;
var missionPhase = 4;
var assassinPhase = 5;
var overPhase = 6;

//enums for min/max player size
var minPlayers = 1; //for debug purposes, should be 5
var maxPlayers = 10;

//These variables are used over the course of the game to keep track of certain stats and players who have voted
var gamePhase = -2;
var gameManager;
var numPlayers = 0;
var voteCount = 0;
var voteCountCount = 0;
var passCount = 0;
var acceptPlayers = [];
var rejectPlayers = [];
var allPlayers = [];
var missionResults = [-1, -1, -1, -1, -1]; //1 = good wins, 2 = bad wins


//These variables are used to keep track of what roles the sender picks and how many evil roles are used.
var merlin = false;
var assassin = false;
var mordred = false;
var percival = false;
var morgana = false;
var oberon = false;
var evilRoles = 0;


window.onload = function() {

  //Upon loading the we set up the receiver for casting and initialize the game manger
  var castReceiverManager = cast.receiver.CastReceiverManager.getInstance();
  var appConfig = new cast.receiver.CastReceiverManager.Config();
  appConfig.statusText = 'My Game is getting ready';
  console.log("AvalonCast is initiating");
  appConfig.maxInactivity = 6000;  // 100 minutes for testing only.

  var gameConfig = new cast.receiver.games.GameManagerConfig();
  gameConfig.applicationName = 'My Game';
  gameConfig.maxPlayers = 10;
  gameManager = new cast.receiver.games.GameManager(gameConfig);

  castReceiverManager.start(appConfig);
  //End initialization

  //Lobby is set to open
  gameManager.updateLobbyState(cast.receiver.games.LobbyState.OPEN, null);
  //This function updates the gamedata, phase is updated to let the senders know to change their current phase
  gameManager.updateGameData({'phase' : lobbyPhase}, false);


  // handler for 'senderdisconnected' event
  castReceiverManager.onSenderDisconnected = function(event) {
    console.log('Received Sender Disconnected event: ' + event.data);
    console.log('num senders: ' + castReceiverManager.getSenders().length);
    if (castReceiverManager.getSenders().length == 0) {
      console.log('calling window.close()');
      window.close();
    }
  };

  // handler for the 'ready' event
  castReceiverManager.onReady = function(event) {
    console.log('Received Ready event: ' + JSON.stringify(event.data));
    //window.castReceiverManager.setApplicationState("Application status is ready...");
  };

  /**
   * Player Available Listener
   */
  gameManager.addEventListener(cast.receiver.games.EventType.PLAYER_AVAILABLE,
  function(event) {
    //console.log("Player Id: " + event.playerInfo.playerId + " is available");
    //document.getElementById("console").innerHTML = "Player Id: " + event.playerInfo.playerId + " is available";
  });


  //When a player is ready they added to the player list
  gameManager.addEventListener(cast.receiver.games.EventType.PLAYER_READY,
  function(event) {

    var playerName = event.requestExtraMessageData.playerName;
    var playerId = event.playerInfo.playerId;


    console.log("Player Name: " + playerName + " is ready with id " + playerId);

    gameManager.updatePlayerData(playerId, {'name' : playerName}, false);

    displayReadyPlayers();



  });

  //This is the core listener for messages. All sender messages are received here and then sorted based on the if/else block
  //Messages come with extra message data which is used to determine what kind of message is sent
  //Messages sent from the wrong game phase are ignored
  gameManager.addEventListener(cast.receiver.games.EventType.GAME_MESSAGE_RECEIVED, function(event){

      gamePhase = gameManager.getGameData().phase;
      console.log("game phase : " + gamePhase);

        //console.log("updatePlayerList " + event.requestExtraMessageData.updatePlayerList);
        console.log("A listener event has occured");
      if(event.requestExtraMessageData.updatePlayerList == "true"){
        console.log("updatePlayerList equals true");
        //displayReadyPlayers();
      }
      /*
      * Lobby Phase
      */
      else if(event.requestExtraMessageData.startGame == "true" && gamePhase == lobbyPhase){
        //get list of ready players
        console.log("Player is trying to start (id): " + event.playerInfo.playerId);
        var readyPlayers = gameManager.getPlayersInState(cast.receiver.games.PlayerState.READY);
        // make sure ready players is between 5 and 10
        if(readyPlayers.length < minPlayers || readyPlayers.length > maxPlayers){
          event.statusCode =  cast.receiver.games.StatusCode.TOO_MANY_PLAYERS;
        } else {
          //set players in ready state to playing state

          gameManager.updateLobbyState(cast.receiver.games.LobbyState.CLOSED, null, true);

          var readyPlayers = gameManager.getPlayersInState(cast.receiver.games.PlayerState.READY);

          document.getElementById("playerList").innerHTML = event.playerInfo.playerData.name + " is setting up the game";



          
          for (var i = 0; i < readyPlayers.length; i++) {
            var playerInfo = readyPlayers[i];
            var playerId = playerInfo.playerId;
            gameManager.updatePlayerState(playerId, cast.receiver.games.PlayerState.PLAYING, null, true);
          }

          var gameData = gameManager.getGameData();
          gameData.setupLeader = event.playerInfo.playerId;
          gameData.setupLeaderName = event.playerInfo.playerData.name;
          gameData.phase = setupPhase;
          gameManager.updateGameData(gameData, false);



          console.log("Moving into setup phase.");
          gameData = gameManager.getGameData();
          console.log("Game data looks like this: " + JSON.stringify(gameData) );

          //close the lobby
          console.log("GAMEPLAY_STATE" + gameManager.getGameplayState());

          //set game state to playing
        }
      }

      /*
      * Select Phase- leader selects a team
      */
      else if (event.requestExtraMessageData.missionTeam != null && gamePhase == selectPhase) {
        console.log("send voting signal");

        var gameData = gameManager.getGameData();
        var missionTeam = event.requestExtraMessageData.missionTeam;
        console.log("first person on team? : " + missionTeam[0]);
        console.log("sent data length: " + event.requestExtraMessageData.missionTeam.length);
        console.log("sent data: " + JSON.stringify(event.requestExtraMessageData.missionTeam));
        console.log("what its supposed to be: " + missionTeamSizes[gameData.missionNum][gameManager.getPlayersInState(cast.receiver.games.PlayerState.PLAYING).length])


        if(missionTeam.length == missionTeamSizes[gameData.missionNum][gameManager.getPlayersInState(cast.receiver.games.PlayerState.PLAYING).length]  )
        {
          gameData.missionTeam = missionTeam;
          gameManager.updateGameData(gameData, true);
          //gameManager.updateGameData({'missionTeam' : event.requestExtraMessageData.missionTeam}, true);
        }
        else
        {
          console.log("bad team size");

        }

        displayMissionTeam();
        document.getElementById("successCard").style = "visibility:hidden";
        document.getElementById("failCard").style = "visibility:hidden";
        document.getElementById("voteInformationLeft").style = "visibility:hidden";
        document.getElementById("voteInformationRight").style = "visibility:hidden";


        //gameManager.updateGameData({'phase': votingPhase}, false);
        gameData = gameManager.getGameData();
        gameData.phase = votingPhase;
        document.getElementById("currLead").innerHTML = "Vote Phase - Leader is " + gameManager.getGameData().leaderName;
        gameManager.updateGameData(gameData, false);
      }

      /*
      * Voting Phase - where players vote on given mission team
      */
      else if (event.requestExtraMessageData.acceptReject != null && gamePhase == votingPhase) {
        console.log("Entering accept or reject listener");

        voteCount++;
        console.log("current vote count is: " + voteCount);

        //update player's hasVoted variable
        var player = event.playerInfo;
        var playerData = player.playerData;
        if(playerData.hasVoted) return;
        playerData.hasVoted = true;
        gameManager.updatePlayerData(player.playerId, playerData, true);

        //If player accepts the mission team we increment the pass count and add them to the accepted players list
        if(event.requestExtraMessageData.acceptReject)
        {
          console.log("Player has accepted using boolean :" + event.playerInfo.playerData.name);
          passCount++;
          acceptPlayers.push(event.playerInfo.playerData.name);
          allPlayers.push(event.playerInfo.playerData.name);
          displayVotesIncomplete();
          document.getElementById("voteInformationLeft").style = "";
          document.getElementById("voteInformationRight").style = "";
        }
        //Otherwise dont increment and add to reject players list
        else
        {
          console.log("Player has rejected :" + event.playerInfo.playerData.name);
          rejectPlayers.push(event.playerInfo.playerData.name);
          allPlayers.push(event.playerInfo.playerData.name);
          displayVotesIncomplete();
          document.getElementById("voteInformationLeft").style = "";
          document.getElementById("voteInformationRight").style = "";
        }

        console.log("if vote count equlas this then we should continue: " + gameManager.getPlayersInState(cast.receiver.games.PlayerState.PLAYING).length);
        //If the vote count equals the number of players then that was the last vote and we can proceed.
        if (voteCount == gameManager.getPlayersInState(cast.receiver.games.PlayerState.PLAYING).length) {

          console.log("all votes have arrived")
          //We move to the mission phase if the passcount is greater than half the vote count
          if (passCount > voteCount / 2) {

            displayVotes();
            document.getElementById("voteInformationLeft").style = "";
            document.getElementById("voteInformationRight").style = "";

            var gameData = gameManager.getGameData();
            document.getElementById("currLead").innerHTML = "Mission Phase - Leader is " + gameManager.getGameData().leaderName;
            gameData.phase = missionPhase;
            gameManager.updateGameData(gameData, false);
            //gameManager.updateGameData({'phase': missionPhase}, false);

          } else {

            displayVotes();
            document.getElementById("voteInformationLeft").style = "";
            document.getElementById("voteInformationRight").style = "";

            voteCountCount++;
            document.getElementById("voteCount").innerHTML = "Vote Count: " + voteCountCount;

            if(voteCountCount == 5)
            {
              console.log("game over");
              document.getElementById("welcome").style = "display:none";
              document.getElementById("gameBoard").style = "display:none";
              document.getElementById("gameOver").style = "";
              var gameData = gameManager.getGameData();
              gameData.phase = overPhase;
              gameData.goodWins = false;
              gameManager.updateGameData(gameData, false);

              evilWins();

            }
            else
            {
              changeLeader();
            }

            //Unnecessary - change leader will call this gameManager.updateGameData({'phase': selectPhase}, false);

          }

          voteCount = 0;
          passCount = 0;
          acceptPlayers = [];
          rejectPlayers = [];
          allPlayers = [];
        }
      }

      /*
      * Mission Phase - where players pass or fail a mission, passing/failing works the same as voting so very similar code
      */
      else if (event.requestExtraMessageData.successFail != null && gamePhase == missionPhase) {
        console.log("Entering successFail listener");
        voteCount++;
        var missionNum = gameManager.getGameData().missionNum;

        //update player's hasMissioned variable
        var player = event.playerInfo;
        var playerData = player.playerData;
        if(playerData.hasMissioned) return;
        playerData.hasMissioned = true;
        gameManager.updatePlayerData(player.playerId, playerData, true);


        if (event.requestExtraMessageData.successFail) {
          passCount++;
          acceptPlayers.push(event.playerInfo.playerData.name);
          allPlayers.push(event.playerInfo.playerData.name);
          displayVotesIncomplete();
          document.getElementById("voteInformationLeft").style = "";
          document.getElementById("voteInformationRight").style = "";
        }
        else
        {
          console.log("Player has rejected :" + event.playerInfo.playerData.name);
          rejectPlayers.push(event.playerInfo.playerData.name);
          allPlayers.push(event.playerInfo.playerData.name);
          displayVotesIncomplete();
          document.getElementById("voteInformationLeft").style = "";
          document.getElementById("voteInformationRight").style = "";
        }

        if (voteCount == missionTeamSizes[missionNum][gameManager.getPlayersInState(cast.receiver.games.PlayerState.PLAYING).length]) {

          if (passCount == voteCount) {

            document.getElementById("successHeader").innerHTML = "Success x" + passCount;
            document.getElementById("successCard").style = "";

            document.getElementById("failHeader").innerHTML = "Fail x0"
            document.getElementById("failCard").style = "";

            //gameManager.updateGameData({'phase': missionPhase}, false);

            document.getElementById(missionNum).parentElement.style = "border-style:solid;border-color:blue";


            missionResults[missionNum] = 1;
            if (checkGameOver()) {



              if (gameManager.getGameData().assassin == null) {
                console.log("game over");
                document.getElementById("welcome").style = "display:none";
                document.getElementById("gameBoard").style = "display:none";
                document.getElementById("gameOver").style = "";
                var gameData = gameManager.getGameData();
                gameData.phase = overPhase;

                gameData.goodWins = true;

                //TODO give assassin a chance to assassinate

                gameManager.updateGameData(gameData, false);

                goodWins();
              }
              else {
                var gameData = gameManager.getGameData();
                gameData.phase = assassinPhase;
                gameManager.updateGameData(gameData, false);
                document.getElementById("currLead").innerHTML = "Assassin is attempting to assassinate Merlin";
              }


            }
            else
            {

              var gameData = gameManager.getGameData();

              document.getElementById("ppm" + gameData.missionNum).parentElement.className = "turn completed";

              gameData.missionNum = gameData.missionNum +1;

              document.getElementById("ppm" + gameData.missionNum).parentElementclassName = "turn current";

              gameData.missionTeamSize =missionTeamSizes[gameData.missionNum][gameManager.getPlayersInState(cast.receiver.games.PlayerState.PLAYING).length];
              gameManager.updateGameData(gameData, true);
              //gameManager.updateGameData({"missionNum" : (missionNum+1)}, true);
              //gameManager.updateGameData({"missionTeamSize" : missionTeamSizes[missionNum+1][gameManager.getPlayersInState(cast.receiver.games.PlayerState.PLAYING).length] }, true);
              voteCountCount = 0;
              document.getElementById("voteCount").innerHTML = "Vote Count: " + voteCountCount;
              changeLeader();
            }

          } else {
            document.getElementById("successHeader").innerHTML = "Success x" + passCount;
            document.getElementById("successCard").style = "";

            var failCount = voteCount - passCount;
            document.getElementById("failHeader").innerHTML = "Fail x" + failCount;
            document.getElementById("failCard").style = "";

            document.getElementById(missionNum).parentElement.style = "border-style:solid;border-color:red";


            missionResults[missionNum] = 2;
            if (checkGameOver()) {
              console.log("game over");
              document.getElementById("welcome").style = "display:none";
              document.getElementById("gameBoard").style = "display:none";
              document.getElementById("gameOver").style = "";
              var gameData = gameManager.getGameData();
              gameData.phase = overPhase;
              gameData.goodWins = false;
              gameManager.updateGameData(gameData, false);
              evilWins();

            }
            else
            {
              var gameData = gameManager.getGameData();

              document.getElementById("ppm" + gameData.missionNum).parentElement.className = "turn completed";

              gameData.missionNum = gameData.missionNum +1;

              document.getElementById("ppm" + gameData.missionNum).parentElementclassName = "turn current";

              gameData.missionTeamSize =missionTeamSizes[gameData.missionNum][gameManager.getPlayersInState(cast.receiver.games.PlayerState.PLAYING).length];
              gameManager.updateGameData(gameData, true);
              //gameManager.updateGameData({"missionNum" : (missionNum+1)}, true);
             // gameManager.updateGameData({"missionTeamSize" : missionTeamSizes[missionNum+1][gameManager.getPlayersInState(cast.receiver.games.PlayerState.PLAYING).length] }, true);
              voteCountCount = 0;
              document.getElementById("voteCount").innerHTML = "Vote Count: " + voteCountCount;
              //gameManager.updateGameData({'phase': selectPhase}, false);
              changeLeader();
            }
          }

          voteCount = 0;
          passCount = 0;
          acceptPlayers = [];
          rejectPlayers = [];
          allPlayers = [];
        }

      }

      /*
      * Setup Phase -  after setup leader has made role choices we look at those choice and mark variables accordingly
      */
      else if (event.requestExtraMessageData.selectedRoles != null && gamePhase == setupPhase) {
        var rolesList = event.requestExtraMessageData.selectedRoles;
        for (var i = 0; i < rolesList.length; i++) {
          switch (rolesList[i]) {
            case "merlin":
              merlin = true;
              break;
            case "assassin":
              assassin = true;
              evilRoles = evilRoles + 1;
              break;
            case "mordred":
              mordred = true;
              evilRoles = evilRoles + 1;
              break;
            case "percival":
              percival = true;
              break;
            case "morgana":
              morgana = true;
              evilRoles = evilRoles + 1;
              break;
            case "oberon":
              oberon = true;
              evilRoles = evilRoles + 1;
              break;
          }
        }
        var gameData = gameManager.getGameData();

        //gameData.merlin = merlin;
        //gameData.assassin = assassin;

        gameManager.updateGameData(gameData, true);

        document.getElementById("welcome").style = "display:none";
        document.getElementById("gameBoard").style = "";
        //TODO accept player role choices
        changeMissionBoxes();
        assignRoles();

      }

      /*
      * Assassin Phase - after assassin chooses target, we look if they are right and move into the correct game over screen based on that.
      */
      else if (event.requestExtraMessageData.assassinGuess != null && gamePhase == assassinPhase) {
        var assassinGuess = event.requestExtraMessageData.assassinGuess;

        var players = gameManager.getPlayersInState(cast.receiver.games.PlayerState.PLAYING);

        var target = gameManager.getPlayer(assassinGuess).playerData.role;
        console.log("Target: " + target);

        if (target == "merlin") {
          console.log("game over");
          document.getElementById("welcome").style = "display:none";
          document.getElementById("gameBoard").style = "display:none";
          document.getElementById("gameOver").style = "";
          var gameData = gameManager.getGameData();
          gameData.phase = overPhase;
          gameData.goodWins = false;
          gameManager.updateGameData(gameData, false);
          evilWins();
        }
        else {
          console.log("game over");
          document.getElementById("welcome").style = "display:none";
          document.getElementById("gameBoard").style = "display:none";
          document.getElementById("gameOver").style = "";

          var gameData = gameManager.getGameData();
          gameData.phase = overPhase;
          gameData.goodWins = true;

          gameManager.updateGameData(gameData, false);

          goodWins();

        }

      }

      /*
      * Game Over Phase - if players hit the move back into lobbby button, we set them to ready and reset all variables and UI screens.
      */
      else if (event.requestExtraMessageData.reset != null && gamePhase == overPhase)
      {
        gameManager.updateLobbyState(cast.receiver.games.LobbyState.OPEN, null, true);

        var playingPlayers = gameManager.getPlayersInState(cast.receiver.games.PlayerState.PLAYING);

        for(var i = 0; i < playingPlayers.length; i++){
            var playerInfo = playingPlayers[i];
            var playerId = playerInfo.playerId;
            gameManager.updatePlayerState(playerId, cast.receiver.games.PlayerState.READY, {"playerName":gameManager.getPlayer(playerId).playerData.name}, true);
          }
        displayReadyPlayers();

        var gameData = gameManager.getGameData();
        gameData.phase = lobbyPhase;

        gameManager.updateGameData(gameData, false);

        resetAll();

        document.getElementById("welcome").style = "";
        document.getElementById("gameOver").style = "display:none";

      }
  });


  //Listeners for player quitting and dropping
  gameManager.addEventListener(cast.receiver.games.EventType.PLAYER_QUIT,
  displayQuitPlayers);

  gameManager.addEventListener(cast.receiver.games.EventType.PLAYER_DROPPED, displayQuitPlayers);

};



    </script>


    <script src="lobby.js"></script>
    <script src="gameLogic.js"></script>
  </body>

</html>
